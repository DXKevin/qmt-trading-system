# QMT 量化交易系统

基于迅投 QMT API 开发的自动化交易系统，通过命名管道接收交易信号并执行下单操作。

## 功能特性

- 🔌 **命名管道通信**：通过 Windows 命名管道接收来自外部程序的交易指令
- 📈 **QMT 交易集成**：封装 XtQuant 交易 API，支持股票交易操作
- 📊 **持仓查询**：实时查询账户资产和持仓信息
- 📝 **日志记录**：自动记录交易日志，支持日志文件自动清理
- 🔄 **多线程处理**：独立线程处理消息接收和交易执行

## 项目结构

```
qmt-trading-system/
├── main.py                 # 程序入口
├── src/                    # 源代码目录
│   ├── trader.py          # 交易执行器
│   ├── reveiver_server.py # 管道接收服务
│   ├── trader_callback.py # 交易回调处理
│   ├── logger.py          # 日志模块
│   └── utils.py           # 工具函数
├── scripts/               
│   └── xtquant/           # QMT API 封装
└── logs/                  # 日志文件目录
```

## 环境要求

- Windows 操作系统
- Python 3.7+
- 迅投 QMT 交易客户端
- 依赖库：
  - `pywin32`（用于命名管道通信）
  - QMT 官方 Python SDK

## 安装配置

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd qmt-trading-system
   ```

2. **安装依赖**
   ```bash
   pip install pywin32
   ```

3. **配置交易客户端**
   
   在 `main.py` 中修改以下配置：
   ```python
   path = r'D:\山西证券QMT交易端-模拟\userdata_mini'  # QMT 客户端路径
   account_id = "11031122"                               # 资金账号
   account_type = "STOCK"                                 # 账户类型
   ```

4. **配置命名管道**
   
   默认管道名称：`\\\\.\\pipe\\to_python_pipe`
   
   如需修改，在 `main.py` 中调整 `pipe_name` 变量。

## 使用说明

### 启动系统

1. 确保 QMT 交易客户端已启动并登录
2. 运行主程序：
   ```bash
   python main.py
   ```

### 发送交易指令

系统通过命名管道接收交易指令，消息格式示例：
```
600000.SH:11031122,11031123;600036.SH:11031124
```

格式说明：
- 股票代码：`600000.SH`（上交所）或 `000001.SZ`（深交所）
- 资金账号：多个账号用逗号分隔
- 不同股票：用分号分隔

### 查看日志

日志文件保存在 `logs/` 目录，系统自动保留最近 5 天的日志。

## 核心模块

### Trader（交易器）
- 连接 QMT 交易客户端
- 执行交易指令
- 查询账户和持仓信息

### ReceiverServer（接收服务）
- 监听命名管道
- 接收外部交易信号
- 将消息放入队列处理

### TraderExecutor（交易执行器）
- 从消息队列获取指令
- 解析交易信号
- 执行账户操作

## 注意事项

⚠️ **重要提示**
- 本系统仅供学习和研究使用
- 实盘交易前请充分测试
- 注意风险控制，合理设置交易参数
- 确保 QMT 客户端已正确配置并登录

## 开发计划

- [ ] 支持更多交易指令类型（买入、卖出、撤单等）
- [ ] 添加策略回测功能
- [ ] 实现风控模块
- [ ] 优化错误处理和异常恢复
- [ ] 添加 Web 控制面板

## 许可证

详见 [LICENSE](LICENSE) 文件

## 贡献

欢迎提交 Issue 和 Pull Request！

---

**免责声明**：本项目仅供学习交流使用，使用者需自行承担交易风险。